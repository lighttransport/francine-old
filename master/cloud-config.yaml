#cloud-config
hostname: <hostname>

coreos:
  etcd:
    name: <hostname>
    discovery: <token_url>
    addr: $private_ipv4:4001
    peer-addr: $private_ipv4:7001
  units:
    - name: etcd.service
      command: start
    - name: lteworker.service
      command: start
      content: |
        [Unit]
        Description=LTE Worker Container
        After=etcd.service
        Requires=etcd.service

        [Service]
        ExecStartPre=/bin/sh -xc "/usr/bin/docker pull `/usr/bin/etcdctl get /lte-bin-url`"
        ExecStart=/bin/sh -xc "/usr/bin/docker run -e \"ETCD_HOST=172.17.42.1:4001\" `/usr/bin/etcdctl get /lte-bin-url` /bin/worker"

        [Install]
        WantedBy=multi-user.target
